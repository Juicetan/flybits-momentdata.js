// @author Justin Lam
// @version master:e2ee368
!function(e){var t={init:{},util:{}};t.cfg={coreMoments:{"com.flybits.moments.gallery":"Gallery","com.flybits.moments.website":"Website","com.flybits.moments.jsonBuilder":"AdvancedObjectBuilder","com.flybits.moments.jsonbuilder":"AdvancedObjectBuilder","com.flybits.moments.youtube":"YouTube","com.flybits.moments.users":"Users","com.flybits.moments.user":"Users","com.flybits.moments.twitter":"Twitter","com.flybits.moments.text":"Text","com.flybits.moments.speedial":"SpeedDial","com.flybits.moments.poll":"Poll","com.flybits.moments.location":"Location","com.flybits.moments.nativeapp":"NativeApp","com.flybits.moments.event":"Events","com.flybits.moments.schedule":"Schedule"}},t.VERSION="master:e2ee368",t.use=function(r){if(!(r instanceof Flybits.ZoneMomentInstance))throw(new t.Validation).addError("Invalid Argument","Must use valid Flybits.ZoneMomentInstance object",{context:"flybitsZMIObj",code:t.Validation.type.INVALIDARG});if(!r.moment)throw(new t.Validation).addError("Malformed Argument","Flybits.ZoneMomentInstance object moment property not found",{context:"flybitsZMIObj.moment",code:t.Validation.type.MALFORMED});var n=r.moment.androidPkg||r.moment.iosPkg,o=t[t.cfg.coreMoments[n]];return o?new o(r):e};var r=function(e){var r=new t.Deferred;return fetch(e).then(function(r){if(200!==r.status)throw(new t.Validation).addError("Configuration file not found","Reverting to default configuration. No configuration found at:"+e,{code:t.Validation.type.INVALIDARG,context:"url"});return r.json()}).then(function(e){t.util.Obj.extend(t.cfg,e),r.resolve(t.cfg)})["catch"](function(n){n instanceof t.Validation?r.reject(n):r.reject((new t.Validation).addError("Failed to read configuration file.","Reverting to default configuration. Configuration format incorrect at:"+e,{code:t.Validation.type.MALFORMED,context:"url"}))}),r.promise},n=function(e){if(!e)return console.log("> config file path not provided: using defaults"),!1;try{var r=fs.readFileSync(e)}catch(n){throw new Error("Config file read failed: "+e)}try{t.util.Obj.extend(t.cfg,JSON.parse(r))}catch(n){throw new Error("Malformed Config file: "+e)}};t.init.server=function(e){n(e)},t.init.browser=function(e){return r(e)},t.initObj=function(e){t.util.Obj.extend(t.cfg,e)},t.util.Api=function(){var t={checkResult:function(e){if(e.status>=200&&e.status<300)return e;throw e},getResultStr:function(e){return e&&e.text?e.text():new Promise(function(e,t){e("")})},getResultJSON:function(e){return e.json()},toURLParams:function(e){for(var t=Object.keys(e),r=t.length,n="";r--;){var o=t[r];""!==n&&(n+="&"),n+=o+"="+encodeURIComponent(e[o])}return n},htmlEncode:function(e){return encodeURIComponent(e)},htmlDecode:function(t){return t.replace(/&#?(\w+);/g,function(t,r){return isNaN(r)&&(chars={quot:34,amp:38,lt:60,gt:62,nbsp:160,copy:169,reg:174,deg:176,frasl:47,trade:8482,euro:8364,Agrave:192,Aacute:193,Acirc:194,Atilde:195,Auml:196,Aring:197,AElig:198,Ccedil:199,Egrave:200,Eacute:201,Ecirc:202,Euml:203,Igrave:204,Iacute:205,Icirc:206,Iuml:207,ETH:208,Ntilde:209,Ograve:210,Oacute:211,Ocirc:212,Otilde:213,Ouml:214,times:215,Oslash:216,Ugrave:217,Uacute:218,Ucirc:219,Uuml:220,Yacute:221,THORN:222,szlig:223,agrave:224,aacute:225,acirc:226,atilde:227,auml:228,aring:229,aelig:230,ccedil:231,egrave:232,eacute:233,ecirc:234,euml:235,igrave:236,iacute:237,icirc:238,iuml:239,eth:240,ntilde:241,ograve:242,oacute:243,ocirc:244,otilde:245,ouml:246,divide:247,oslash:248,ugrave:249,uacute:250,ucirc:251,uuml:252,yacute:253,thorn:254,yuml:255,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,permil:8240,lsaquo:8249,rsaquo:8250,spades:9824,clubs:9827,hearts:9829,diams:9830,oline:8254,larr:8592,uarr:8593,rarr:8594,darr:8595,hellip:133,ndash:150,mdash:151,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,brkbar:166,sect:167,uml:168,die:168,ordf:170,laquo:171,not:172,shy:173,macr:175,hibar:175,plusmn:177,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,sup1:185,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,Alpha:913,alpha:945,Beta:914,beta:946,Gamma:915,gamma:947,Delta:916,delta:948,Epsilon:917,epsilon:949,Zeta:918,zeta:950,Eta:919,eta:951,Theta:920,theta:952,Iota:921,iota:953,Kappa:922,kappa:954,Lambda:923,lambda:955,Mu:924,mu:956,Nu:925,nu:957,Xi:926,xi:958,Omicron:927,omicron:959,Pi:928,pi:960,Rho:929,rho:961,Sigma:931,sigma:963,Tau:932,tau:964,Upsilon:933,upsilon:965,Phi:934,phi:966,Chi:935,chi:967,Psi:936,psi:968,Omega:937,omega:969},chars[r]!==e&&(r=chars[r])),String.fromCharCode(r)})},parseResponse:function(e){return JSON.parse(e,function(e,r){return"string"==typeof r?t.htmlDecode(r):r})},parseErrorMsg:function(e){try{var t=this.parseResponse(e)}catch(r){return"Malformed server response"}var n=null;return t?t.messageJSON||t.exceptionMessage||t.message||"Unexpected error has occurred":n},parsePaging:function(e){return{offset:e.pagination.offset,limit:e.pagination.limit,total:e.pagination.totalRecords}},createNextPageCall:function(e,t,r){return r.offset+r.limit>=r.total?null:function(){return t.paging={limit:r.limit,offset:r.offset+r.limit},e(t)}}};return t}(),t.util.Obj=function(){var e={extend:function(e,t){if("function"==typeof $&&"function"==typeof $.extend)return $.extend(!0,e,t);if("function"==typeof _&&"function"==typeof _.extend)return _.extend(e,t);for(var r in t)t[r]&&t[r].constructor&&t[r].constructor===Object?(e[r]=e[r]||{},arguments.callee(e[r],t[r])):e[r]=t[r];return e},guid:function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return"j"+e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}};return e}(),t.Deferred=function(){Promise.settle=function(e){var t=e.map(function(e){return e.then(function(e){return{result:e,status:"resolved"}},function(e){return{result:e,status:"rejected"}})});return Promise.all(t)};var e=function(){var e=this;this.promise=new Promise(function(t,r){e.resolve=t,e.reject=r}),this.then=this.promise.then.bind(this.promise),this["catch"]=this.promise["catch"].bind(this.promise)};return e}(),t.Validation=function(){var e=function(){this.state=!0,this.errors=[]};return e.prototype.type=e.type={},e.prototype.type.MALFORMED=e.type.MALFORMED=1e3,e.prototype.type.INVALIDARG=e.type.INVALIDARG=1001,e.prototype.type.MISSINGARG=e.type.MISSINGARG=1002,e.prototype.type.NOTFOUND=e.type.NOTFOUND=1003,e.prototype.type.CONNECTIONERROR=e.type.CONNECTIONERROR=1004,e.prototype.type.UNAUTHENTICATED=e.type.UNAUTHENTICATED=1005,e.prototype.type.RETRIEVALERROR=e.type.RETRIEVALERROR=1006,e.prototype.type.NOTSUPPORTED=e.type.NOTSUPPORTED=1007,e.prototype={addError:function(e,t,r){this.state=!1;var n={header:e,message:t};return r&&(n.context=r.context,n.code=r.code,n.serverCode=r.serverCode),this.errors.push(n),this},firstError:function(){return this.errors.length>0?this.errors[0]:null}},e}();var o=function(){var e=t.Deferred,r=t.util.Api,n=t.Validation,o=function(e){if("Object"===this.constructor.name)throw new Error("Abstract classes cannot be instantiated");this.zmi=e,this.host=e.moment.clientURL,this.type=e.moment.androidPkg||e.moment.iosPkg,this.isValidated=!1};return o.prototype={res:{VALIDATE:"/validate"},getData:function(){var t=this;if(!this.isValidated){var r=new e;return this.validate().then(function(){return t.isValidated=!0,t.getMainData()}).then(function(e){r.resolve(e)})["catch"](function(e){r.reject(e)}),r.promise}return this.getMainData()},validate:function(){var t=new e,o=this.host+this.res.VALIDATE;return this.zmi.getAccessToken().then(function(e){return o+="?signature="+e,fetch(o,{method:"GET",credentials:"include"})}).then(r.checkResult).then(function(e){t.resolve(e)})["catch"](function(e){r.getResultStr(e).then(function(r){t.reject((new n).addError("Authorization failed.",r,{serverCode:e.status}))})}),t.promise}},o}();if(t.AdvancedObjectBuilder=function(){var e=t.util.Obj,r=t.util.Api,n=t.Deferred,i=t.Validation,s=function(e){o.call(this,e)};s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.res=s.res=e.extend({JSON:"/KeyValuePairs/AsMetadata"},o.prototype.res);var a=function(e){var t=!1,r=JSON.stringify(e);return JSON.parse(r,function(e,r){""!==e&&"object"!=typeof r&&(t=t||r&&""!==r)}),!t},c=function(e){if(e.templateId&&(e.structureKey=e.templateId,delete e.templateId),e.localizedKeyValuePairs){e.localization={};for(var t=Object.keys(e.localizedKeyValuePairs),r=t.length;r--;){var n=t[r],o=e.localizedKeyValuePairs[n];o&&o.root&&!a(o.root)&&(e.localization[n]=o.root)}delete e.localizedKeyValuePairs}return e};return s.prototype.getMainData=function(){var e=new n,t=this.host+this.res.JSON;return fetch(t,{method:"GET",credentials:"include"}).then(r.checkResult).then(r.getResultStr).then(function(t){try{var n=r.parseResponse(t);n&&(n=c(n)),e.resolve(n)}catch(o){e.reject((new i).addError("Request Failed","Unexpected server response.",{code:i.type.MALFORMED}))}})["catch"](function(t){r.getResultStr(t).then(function(r){e.reject((new i).addError("Object retrieval failed",r,{serverCode:t.status}))})}),e.promise},s}(),t.Events=function(){var e=t.util.Obj,r=t.util.Api,n=t.Deferred,i=t.Validation,s=function(e){o.call(this,e)};s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.res=s.res=e.extend({EVENTS:"/events"},o.prototype.res);var a=function(e){var t=Object.keys(e.locales),r=t.length,n=e.locales.en?e.locales.en:e.locales[t[0]];for(e.shareMessages={facebook:n.facebookShareMessage,instagram:n.instagramShareMessage,linkedin:n.linkedInShareMessage,twitter:n.twitterShareMessage},delete e.facebookShareMessage,delete e.instagramShareMessage,delete e.linkedInShareMessage,delete e.twitterShareMessage;r--;){var o=e.locales[t[r]];delete o.facebookShareMessage,delete o.instagramShareMessage,delete o.linkedInShareMessage,delete o.twitterShareMessage}return e},c=function(e){var t=Object.keys(e.locales),r=t.length,n=e.locales.en?e.locales.en:e.locales[t[0]];for(e.galleryTitle=n.galleryTitle,e.galleryDescription=n.galleryDescription;r--;){var o=e.locales[t[r]];delete o.galleryTitle,delete o.galleryDescription,delete o.title}},l=function(t){var r={events:[]};return t.length>0&&(r.events=t.map(function(t){return a(t),c(t),t.images=t.images.map(function(t){t=a(t);var r=Object.keys(t.locales);return t=e.extend(t,t.locales[r[0]]),delete t.locales,delete t.locale,delete t.fileExtension,delete t.fileName,t}),t.videos=t.videos.map(function(t){t=a(t);var r=Object.keys(t.locales);return t=e.extend(t,t.locales[r[0]]),delete t.locales,delete t.locale,delete t.fileExtension,delete t.fileName,t}),delete t.eventName,delete t.description,delete t.title,delete t.location,delete t.phoneNumber,t})),r};return s.prototype.getMainData=function(){var e=new n,t=this.host+this.res.EVENTS;return fetch(t,{method:"GET",credentials:"include"}).then(r.checkResult).then(r.getResultStr).then(function(t){try{var n=r.parseResponse(t);n&&(n=l(n)),e.resolve(n)}catch(o){e.reject((new i).addError("Request Failed","Unexpected server response.",{code:i.type.MALFORMED}))}})["catch"](function(t){r.getResultStr(t).then(function(r){e.reject((new i).addError("Events retrieval failed",r,{serverCode:t.status}))})}),e.promise},s}(),t.Gallery=function(){var e=t.util.Obj,r=t.util.Api,n=t.Deferred,i=t.Validation,s=function(e){o.call(this,e)};s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.res=s.res=e.extend({GALLERIES:"/Galleries",COMMENTS:"/Comments",FILES:"/FileEntity"},o.prototype.res);var a=function(e){return delete e.momentId,delete e.momentInstanceId,delete e.zoneMomentInstanceId,delete e.serviceId,e.id=e.galleryId,delete e.galleryId,e.images=e.fileEntities.map(function(e){return delete e.momentId,delete e.momentInstanceId,delete e.zoneMomentInstanceId,delete e.isApproved,delete e.fileName,delete e.fileType,e.id=e.fileId,delete e.fileId,e}),delete e.fileEntities,e},c=function(e){return{comments:e.comments}};return s.prototype.getMainData=function(){var e=new n,t=this.host+this.res.GALLERIES+"?getAll=false&isApproved=true";return fetch(t,{method:"GET",credentials:"include"}).then(r.checkResult).then(r.getResultStr).then(function(t){try{var n=r.parseResponse(t);n&&(n=a(n)),e.resolve(n)}catch(o){e.reject((new i).addError("Request Failed","Unexpected server response.",{code:i.type.MALFORMED}))}})["catch"](function(t){r.getResultStr(t).then(function(r){e.reject((new i).addError("Gallery retrieval failed",r,{serverCode:t.status}))})}),e.promise},s.prototype.getImageComments=function(e){var t=new n,o=this.host+this.res.COMMENTS+"/"+e+"?top=1000&isApproved=true";return fetch(o,{method:"GET",credentials:"include"}).then(r.checkResult).then(r.getResultStr).then(function(e){try{var n=r.parseResponse(e);n&&(n=c(n)),t.resolve(n)}catch(o){t.reject((new i).addError("Request Failed","Unexpected server response.",{code:i.type.MALFORMED}))}})["catch"](function(e){r.getResultStr(e).then(function(r){t.reject((new i).addError("Gallery image comments retrieval failed",r,{serverCode:e.status}))})}),t.promise},s.prototype.uploadImageFromFile=function(e){var t=new n,r=this.host+this.res.FILES;return allUpload({targetURL:r,fileParamName:"data",acceptStr:"image/*",onfilechange:function(r){r?e(r):(e(),t.reject((new i).addError("File not selected","",{code:i.type.MISSINGARG,context:"data"})))}}).then(function(e){var r=e.querySelector("FileURL").innerHTML;t.resolve(r)})["catch"](function(e){t.reject((new i).addError("Image upload failed.",e))}),t.promise},s}(),t.Location=function(){var e=t.util.Obj,r=t.util.Api,n=t.Deferred,i=t.Validation,s=function(e){o.call(this,e)};return s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.res=s.res=e.extend({LOCATION:"/locationbits"},o.prototype.res),s.prototype.getMainData=function(){var e=new n,t=this.host+this.res.LOCATION+"?alllocales=true";return fetch(t,{method:"GET",credentials:"include"}).then(r.checkResult).then(r.getResultStr).then(function(t){try{var n=r.parseResponse(t);e.resolve(n)}catch(o){e.reject((new i).addError("Request Failed","Unexpected server response.",{code:i.type.MALFORMED}))}})["catch"](function(t){r.getResultStr(t).then(function(r){e.reject((new i).addError("Locations retrieval failed",r,{serverCode:t.status}))})}),e.promise},s}(),t.NativeApp=function(){var e=t.util.Obj,r=t.util.Api,n=t.Deferred,i=t.Validation,s=function(e){o.call(this,e)};s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.res=s.res=e.extend({APPS:"/apps"},o.prototype.res);var a=function(e){var t={apps:[]};return e.length>0&&(t.apps=e.map(function(e){return delete e.serviceId,e})),t};return s.prototype.getMainData=function(){var e=new n,t=this.host+this.res.APPS;return fetch(t,{method:"GET",credentials:"include"}).then(r.checkResult).then(r.getResultStr).then(function(t){try{var n=r.parseResponse(t);n&&(n=a(n)),e.resolve(n)}catch(o){e.reject((new i).addError("Request Failed","Unexpected server response.",{code:i.type.MALFORMED}))}})["catch"](function(t){r.getResultStr(t).then(function(r){e.reject((new i).addError("App retrieval failed",r,{serverCode:t.status}))})}),e.promise},s}(),t.Poll=function(){var e=t.util.Obj,r=t.util.Api,n=t.Deferred,i=t.Validation,s=function(e){o.call(this,e)};s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.res=s.res=e.extend({POLLS:"/votingpollbits",POLL:"/VotingPolls"},o.prototype.res),s.SINGLESELECT=s.prototype.SINGLESELECT=0,s.MULTISELECT=s.prototype.MULTISELECT=1;var a=function(e){var t={id:e.id,startEpoch:e.startsAt,endEpoch:e.endsAt,polls:[],allowVoteUpdates:e.allowUpdateVotes};return e.votingPolls.length>0&&(t.polls=e.votingPolls.map(function(e){return{id:e.id,type:e.type,question:e.question,hasUserVoted:e.hasUserVoted,choices:e.choices.map(function(e){return{id:e.id,text:e.text,votes:e.votes}})}})),t};s.prototype.getMainData=function(){var e=new n,t=this.host+this.res.POLLS+"?alllocales=true";return fetch(t,{method:"GET",credentials:"include",headers:{"Accept-Language":"en"}}).then(r.checkResult).then(r.getResultStr).then(function(t){try{var n=r.parseResponse(t);n&&(n=a(n)),e.resolve(n)}catch(o){e.reject((new i).addError("Request Failed","Unexpected server response.",{code:i.type.MALFORMED}))}})["catch"](function(t){r.getResultStr(t).then(function(r){e.reject((new i).addError("Poll retrieval failed",r,{serverCode:t.status}))})}),e.promise};var c=function(e,t){var o=new n,s=this.host+this.res.POLL+"/"+e+"/Vote";return fetch(s,{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify(t)}).then(r.checkResult).then(r.getResultStr).then(function(e){o.resolve()})["catch"](function(n){r.getResultStr(n).then(function(r){o.reject((new i).addError("Failed to submit vote",r,{serverCode:n.status,context:{pollID:e,choiceIDArr:t}}))})}),o.promise};return s.prototype.submitVote=function(e){for(var t=new n,r=Object.keys(e),o=[],s=0;s<r.length;s++){var a=c.call(this,r[s],e[r[s]]);o.push(a)}return Promise.settle(o).then(function(e){var r=e.filter(function(e){return"rejected"===e.status}),n=r.map(function(e){return e.result.firstError()});if(r.length>0){var o=new i;o.errors=n,t.reject(o)}else t.resolve()}),t.promise},s}(),t.Schedule=function(){var e=t.util.Obj,r=t.util.Api,n=t.Deferred,i=t.Validation,s=function(e){o.call(this,e)};s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.res=s.res=e.extend({SCHEDULES:"/hoursofoperations"},o.prototype.res);var a=function(e){var t={schedules:[]};return e.length>0&&(t.schedules=e.map(function(e){return{oneTimeRange:e.range,weekly:{monday:e.monday,tuesday:e.tuesday,wednesday:e.wednesday,thursday:e.thursday,friday:e.friday,saturday:e.saturday,sunday:e.sunday}}})),t};return s.prototype.getMainData=function(){var e=new n,t=this.host+this.res.SCHEDULES;return fetch(t,{method:"GET",credentials:"include"}).then(r.checkResult).then(r.getResultStr).then(function(t){try{var n=r.parseResponse(t);n&&(n=a(n)),e.resolve(n)}catch(o){e.reject((new i).addError("Request Failed","Unexpected server response.",{code:i.type.MALFORMED}))}})["catch"](function(t){r.getResultStr(t).then(function(r){e.reject((new i).addError("Schedule retrieval failed",r,{serverCode:t.status}))})}),e.promise},s}(),t.SpeedDial=function(){var e=t.util.Obj,r=t.util.Api,n=t.Deferred,i=t.Validation,s=function(e){o.call(this,e)};s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.res=s.res=e.extend({PHONENUMBERS:"/phonenumbers"},o.prototype.res);var a=function(e){var t={phonenumbers:[]};return e.length>0&&(t.phonenumbers=e.map(function(e){return{id:e.id,fullNumber:e.fullPhoneNumber,areaCode:e.areaCode,countryCode:e.countryCode,exchangeNumber:e.exchangeNumber}})),t};return s.prototype.getMainData=function(){var e=new n,t=this.host+this.res.PHONENUMBERS;return fetch(t,{method:"GET",credentials:"include"}).then(r.checkResult).then(r.getResultStr).then(function(t){try{var n=r.parseResponse(t);n&&(n=a(n)),e.resolve(n)}catch(o){e.reject((new i).addError("Request Failed","Unexpected server response.",{code:i.type.MALFORMED}))}})["catch"](function(t){r.getResultStr(t).then(function(r){e.reject((new i).addError("Phone number retrieval failed",r,{serverCode:t.status}))})}),e.promise},s}(),t.Text=function(){var e=t.util.Obj,r=t.util.Api,n=t.Deferred,i=t.Validation,s=function(e){o.call(this,e)};s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.res=s.res=e.extend({TEXTS:"/texts"},o.prototype.res);var a=function(e){var t={texts:[]};return e.length>0&&(t.texts=e.map(function(e){var t={id:e.id,locales:{}},r=Object.keys(e.locales);return r.forEach(function(r){var n=e.locales[r];t.locales[r]={content:n.description}}),t})),t};return s.prototype.getMainData=function(){var e=new n,t=this.host+this.res.TEXTS;return fetch(t,{method:"GET",credentials:"include"}).then(r.checkResult).then(r.getResultStr).then(function(t){try{var n=r.parseResponse(t);n&&(n=a(n)),e.resolve(n)}catch(o){e.reject((new i).addError("Request Failed","Unexpected server response.",{code:i.type.MALFORMED}))}})["catch"](function(t){r.getResultStr(t).then(function(r){e.reject((new i).addError("Texts retrieval failed",r,{serverCode:t.status}))})}),e.promise},s}(),t.Twitter=function(){var e=t.util.Obj,r=t.util.Api,n=t.Deferred,i=t.Validation,s=function(e){o.call(this,e)};return s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.res=s.res=e.extend({TWEETS:"/tweets"},o.prototype.res),s.prototype.getMainData=function(){var e=new n,t=this.host+this.res.TWEETS;return fetch(t,{method:"GET",credentials:"include"}).then(r.checkResult).then(r.getResultStr).then(function(t){try{var n=r.parseResponse(t);e.resolve(n)}catch(o){e.reject((new i).addError("Request Failed","Unexpected server response.",{code:i.type.MALFORMED}))}})["catch"](function(t){r.getResultStr(t).then(function(r){e.reject((new i).addError("Tweets retrieval failed",r,{serverCode:t.status}))})}),e.promise},s}(),t.Users=function(){var e=t.util.Obj,r=t.util.Api,n=t.Deferred,i=t.Validation,s=function(e){o.call(this,e)};s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.res=s.res=e.extend({USERS:"/usersbits"},o.prototype.res);var a=function(e){return{email:e.email,mailTo:{subject:e.emailMeSubject,body:e.emailMeBody},bio:e.aboutMe,phoneNumber:e.phoneNumber,title:e.position,firstName:e.firstName,lastName:e.lastName,socialURLs:{instagram:e.instagramUrl,facebook:e.facebookUrl,twitter:e.twitterUrl,spotify:e.spotifyUrl,iTunes:e.iTunesUrl,googlePlay:e.googleMusicStoreUrl},misc:{branchTransitNumber:e.branchTransitNumber}}},c=function(e){var t={id:e.id,displayBioOnMainView:e.displayBioOnMainView,users:[]};return t.users=e.users.map(function(e){var t={id:e.id,locales:{},profileImg:e.imageUrl,coverImg:e.backgroundImageUrl};if(e.locales){var r=Object.keys(e.locales);r.forEach(function(r){var n=e.locales[r];t.locales[r]=a(n)})}return t}),t};return s.prototype.getMainData=function(){var e=new n,t=this.host+this.res.USERS+"?alllocales=true";return fetch(t,{method:"GET",credentials:"include"}).then(r.checkResult).then(r.getResultStr).then(function(t){try{var n=r.parseResponse(t);n&&(n=c(n)),e.resolve(n)}catch(o){e.reject((new i).addError("Request Failed","Unexpected server response.",{code:i.type.MALFORMED}))}})["catch"](function(t){r.getResultStr(t).then(function(r){e.reject((new i).addError("Users retrieval failed",r,{serverCode:t.status}))})}),e.promise},s}(),t.Website=function(){var e=t.util.Obj,r=t.util.Api,n=t.Deferred,i=t.Validation,s=function(e){o.call(this,e)};return s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.res=s.res=e.extend({WEBSITES:"/websitebits"},o.prototype.res),s.prototype.getMainData=function(){var e=new n,t=this.host+this.res.WEBSITES;return fetch(t,{method:"GET",credentials:"include"}).then(r.checkResult).then(r.getResultStr).then(function(t){try{var n=r.parseResponse(t);e.resolve(n)}catch(o){e.reject((new i).addError("Request Failed","Unexpected server response.",{code:i.type.MALFORMED}))}})["catch"](function(t){r.getResultStr(t).then(function(r){e.reject((new i).addError("Website retrieval failed",r,{serverCode:t.status}))})}),e.promise},s}(),t.YouTube=function(){var e=t.util.Obj,r=t.util.Api,n=t.Deferred,i=t.Validation,s=function(e){o.call(this,e)};s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.res=s.res=e.extend({YOUTUBEBITS:"/youtubebits"},o.prototype.res);var a=function(e){var t=Object.keys(e),r={id:null,videos:[]};if(t.length>0&&e[t[0]].youtubeVideos.length>0){var n=e[t[0]];r.id=n.id,r.videos=n.youtubeVideos.map(function(e){return{id:e.video.id,url:e.videoUrl,embedURL:e.embeddedUrl,title:e.video.snippet.title,description:e.video.snippet.description,channelID:e.video.snippet.channelId,channelTitle:e.video.snippet.channelTitle,thumbnails:{"default":e.video.snippet.thumbnails["default"],med:e.video.snippet.thumbnails.medium||e.video.snippet.thumbnails.high||e.video.snippet.thumbnails["default"],high:e.video.snippet.thumbnails.maxres||e.video.snippet.thumbnails.standard||e.video.snippet.thumbnails.high||e.video.snippet.thumbnails.medium||e.video.snippet.thumbnails["default"]}}})}return r};return s.prototype.getMainData=function(){var e=new n,t=this.host+this.res.YOUTUBEBITS+"?alllocales=true";return fetch(t,{method:"GET",credentials:"include"}).then(r.checkResult).then(r.getResultStr).then(function(t){try{var n=r.parseResponse(t);n&&(n=a(n)),e.resolve(n)}catch(o){e.reject((new i).addError("Request Failed","Unexpected server response.",{code:i.type.MALFORMED}))}})["catch"](function(t){r.getResultStr(t).then(function(r){e.reject((new i).addError("YouTube video retrieval failed",r,{serverCode:t.status}))})}),e.promise},s}(),"object"==typeof window)window.Fmd=t,t.init=t.init.browser;else if("object"==typeof exports&&"undefined"!=typeof module){require("fs");Flybits=require("flybits"),t.init=t.init.server,module.exports=t}else"function"==typeof define&&define.amd?define(function(){return t.init=t.init.server,t}):(t.init=t.init.server,global.Fmd=t)}();